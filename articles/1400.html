<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="../css/images/logo.png">
  
  <title>
    
      LeetCode 355 Design Twitter | Xuan&#39;s Blog
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="../js/qrious.js"></script>
<script src="../js/gitment.js"></script>
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="../index.html">
      <div class="logo"></div>
      <span>Xuan's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="../index.html" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="../tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="../archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="../project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="../about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="../index.html" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="../tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="../archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="../project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="../about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>LeetCode 355 Design Twitter</h2>
  <p class="post-date">2016-07-18</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><blockquote>
<p>题目链接：<a href="https://leetcode.com/problems/design-twitter/" target="_blank" rel="external">Design Twitter</a></p>
<p>题意：设计一个简单版的Twitter，包括发tweets，关注/取消关注，系统推送自己关注的1o条最新的tweets（包括自己的）<br>居然随机到了一道设计题，刚开始觉得很简单啊，随便就能实现了，但是仔细想了下，要实现高效率并不简单，中途修改了两次设计，总算是比较满意了。</p>
<p><pre class="lang:java decode:true">import java.util.ArrayList;<br>import java.util.HashMap;<br>import java.util.HashSet;<br>import java.util.LinkedList;<br>import java.util.List;</pre></p>
</blockquote>
<p>/**</p>
<ul>
<li>161 ms</li>
<li></li>
<li>@author xuan<br><em>
</em>/</li>
</ul>
<p>public class Twitter {</p>
<pre><code>private HashMap&amp;lt;Integer, ArrayList&amp;lt;Integer&amp;gt;&amp;gt; post; // key:userId,value:tweetIdList
private HashMap&amp;lt;Integer, HashSet&amp;lt;Integer&amp;gt;&amp;gt; follow; // key:followerId,value:followeeIdSet
private HashMap&amp;lt;Integer, Integer&amp;gt; postTime;
private int postCount;

/** Initialize your data structure here. */
public Twitter() {
    postTime = new HashMap&amp;lt;Integer, Integer&amp;gt;();
    post = new HashMap&amp;lt;Integer, ArrayList&amp;lt;Integer&amp;gt;&amp;gt;();
    follow = new HashMap&amp;lt;Integer, HashSet&amp;lt;Integer&amp;gt;&amp;gt;();
    postCount = 0;
}

/**
 * Compose a new tweet.
 * 
 * O(1)
 */
public void postTweet(int userId, int tweetId) {
    if (!post.containsKey(userId)) {
        post.put(userId, new ArrayList&amp;lt;Integer&amp;gt;());
        follow(userId, userId);
    }
    post.get(userId).add(tweetId);
    postTime.put(tweetId, postCount++);
}

/**
 * Retrieve the 10 most recent tweet ids in the user&apos;s news feed. Each item
 * in the news feed must be posted by users who the user followed or by the
 * user herself. Tweets must be ordered from most recent to least recent.
 * 
 * O(10*followeeCount)
 */
public List&amp;lt;Integer&amp;gt; getNewsFeed(int userId) {

    int count = 0;
    List&amp;lt;Integer&amp;gt; ans = new LinkedList&amp;lt;Integer&amp;gt;();
    ArrayList&amp;lt;ArrayList&amp;lt;Integer&amp;gt;&amp;gt; list = new ArrayList&amp;lt;ArrayList&amp;lt;Integer&amp;gt;&amp;gt;();
    ArrayList&amp;lt;Integer&amp;gt; index = new ArrayList&amp;lt;Integer&amp;gt;();
    HashSet&amp;lt;Integer&amp;gt; set = follow.get(userId);
    if (set == null)
        return ans;
    for (Integer o : set) {
        ArrayList l = post.get(o);
        if (l != null) {
            list.add(l);
            index.add(l.size() - 1);
        }
    }

    while (count &amp;lt; 10) {
        int max = -1;
        int loc = -1;
        for (int i = 0; i &amp;lt; list.size(); ++i) {
            ArrayList l = list.get(i);
            if (index.get(i) &amp;lt; 0)
                continue;
            int e = (Integer) l.get(index.get(i));
            if (loc == -1 || postTime.get(e) &amp;gt; postTime.get(max)) {
                max = e;
                loc = i;
            }
        }
        if (max == -1 || loc == -1) {
            break;
        } else {
            ans.add(max);
            index.set(loc, index.get(loc) - 1);
            count++;
        }
    }

    return ans;
}

/**
 * Follower follows a followee. If the operation is invalid, it should be a
 * no-op.
 * 
 * O(1)
 */
public void follow(int followerId, int followeeId) {
    if (!follow.containsKey(followerId)) {
        follow.put(followerId, new HashSet&amp;lt;Integer&amp;gt;());
    }
    follow.get(followerId).add(followeeId);
}

/**
 * Follower unfollows a followee. If the operation is invalid, it should be
 * a no-op.
 * 
 * O(1)
 */
public void unfollow(int followerId, int followeeId) {
    if (followerId != followeeId &amp;amp;&amp;amp; follow.containsKey(followerId)) {
        follow.get(followerId).remove(followeeId);
    }
}
</code></pre><p>}</p>
<p>/**</p>
<ul>
<li>Your Twitter object will be instantiated and called as such:</li>
<li>Twitter obj = new Twitter();</li>
<li>obj.postTweet(userId,tweetId);</li>
<li>List&lt;Integer&gt; param_2 = obj.getNewsFeed(userId);</li>
<li>obj.follow(followerId,followeeId);</li>
<li>obj.unfollow(followerId,followeeId);<br>*/<br>用一个<span class="lang:java decode:true crayon-inline ">HashMap&lt;Integer, HashSet&lt;Integer&gt;&gt;</span> 来记录关注情况，其中<span class="lang:java decode:true crayon-inline">key</span> 为<span class="lang:java decode:true crayon-inline">userId</span> ，<span class="lang:java decode:true crayon-inline">value</span> 为该用户的<span class="lang:java decode:true crayon-inline">followeeIdSet</span> ，这样可以在(O(1))的时间完成查询a是否关注了b和关注/取消关注功能</li>
</ul>
<p>比较复杂的是推送功能，一开始想的是用一个LinkedHashMap实现tweetId与userId的关联，同时保证tweetId按时间顺序排列，但是这样在推送时最坏需要扫描所有tweetId，这样复杂度就比较高了，因为tweet的数量会比较多。</p>
<p>之后改成了用<span class="lang:java decode:true crayon-inline ">HashMap&lt;Integer, ArrayList&lt;Integer&gt;&gt;</span> 来记录每人发的tweets，<span class="lang:java decode:true crayon-inline ">key</span> 为<span class="lang:java decode:true crayon-inline ">userId</span> ，<span class="lang:java decode:true crayon-inline ">value</span> 为该用户的<span class="lang:java decode:true crayon-inline">tweetIdList</span> ，之后在推送时，将该用户所有关注者的<span class="lang:java decode:true crayon-inline">tweetIdList</span> 取出组成一个新的List，之后在每次扫描所有<span class="lang:java decode:true crayon-inline ">tweetIdList</span> 的最后一个元素（即最后发布的）,找出时间最晚的，放入推送List。这样的复杂度为(O(10\times followeeCount))，(followeeCount)为该用户关注人数</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</section>
    <!-- Tags START -->
    
    <!-- Tags END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice">扫描二维码，分享此文章</p>
    </div>
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="nav">none</ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://qinshaoxuan.com/articles/1400.html';
    var banner = ''
    if (banner !== 'undefined') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "yanm1ng";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "LeetCode 355 Design Twitter",
        owner: "yanm1ng",
        repo: "yanm1ng.github.io",
        oauth: {
          client_id: "0f87e490e00ee3fd87ef",
          client_secret: "4a9d2b148e7971c2201ad12131ce8bf8159ccd2e"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2017 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine == 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="../js/script.js"></script>
  </body>
</html>